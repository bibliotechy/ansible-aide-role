---
# install the AIDE IDS on a server

  - name: Install all those dependencies
    apt: pkg={{item}} state=present
    with_items:
      - aide
      - aide-common
    tags:
      - install

  - name: change up the email to send to us
    lineinfile:
      dest: /etc/default/aide
      regexp: '^MAILTO'
      line: "MAILTO={{ email_to }}"
      state: present
    tags:
      - install

  - name: no need for an email if nothing has changed
    lineinfile:
      dest: /etc/default/aide
      regexp: '^QUIETREPORTS'
      line: "QUIETREPORTS={{ quiet_reports }}"
      state: present
    tags:
      - install

  - name: Just do the sha256 checksum or it takes forever
    lineinfile: 
      dest=/etc/aide/aide.conf 
      regexp="^Checksums" 
      line="Checksums = {{ checksums }}" 
      state=present
    tags:
      - install

  - name: change up aide.conf to standards
    lineinfile:
      dest: /etc/aide/aide.conf
      regexp: "{{ item.regex }}"
      line: "{{ item.line }}"
      state: present
    with_items: aide_ignore_list
    tags:
      - install

  - name:  Add crontab to reset DB nightly
    cron:
      user="root"
      name="Redo Aide DB nightly"
      hour=23
      minute=45
      job="/usr/sbin/aideinit -y -f"
    tags:
      - install

    notify:
      - init aide database
